# recursive test 
#script\gen_sample C:\workspace\shbrgen\rebrgen\src\test\recursive.bgn

enum StorageType:
    :u8
    # terminal
    INT   
    UINT 
    FLOAT 
    STRUCT_REF
    RECURSIVE_STRUCT_REF
    BYTE_VECTOR # special case of vector

    # qualifiers
    ENUM
    ARRAY
    VECTOR
    # for recursive type
    PTR
    # for union
    VARIANT

format Varint:
    prefix :u2
    match prefix:
        0 => value :u6
        1 => value :u14
        2 => value :u30
        3 => value :u62


format Storage:
    type :StorageType
    match type:
        StorageType.INT:
            size :Varint
        StorageType.UINT:
            size :Varint
        StorageType.FLOAT:
            size :Varint
        StorageType.STRUCT_REF:
            ref :Varint
        StorageType.RECURSIVE_STRUCT_REF:
            ref :Varint
        StorageType.BYTE_VECTOR:
            ..
        StorageType.ENUM:
            ref :Varint
            base :Storage
        StorageType.ARRAY:
            size :Varint
            base :Storage
        StorageType.VECTOR:
            ref :Varint
            base :Storage
        StorageType.VARIANT:
            ref :Varint 
            size :Varint
            variants :[size.value]Storage

format X:
    x :X

state M:
    s :bool