/*DO NOT EDIT BELOW SECTION MANUALLY*/
/*license*/
// Template generated by ebmcodegen at https://github.com/on-keyday/rebrgen
/*
  Name: Statement_FUNCTION_DECL_class
  Available Variables:
    ctx: Context_Statement_FUNCTION_DECL
      visitor: MergedVisitor&
        program_name: static constexpr const char*
        module_: ebmgen::MappingTable
        flags: Flags&
        output: Output&
        wm: ebmcodegen::WriterManager<CodeWriter>
      item_id: ebm::StatementRef
      kind: const ebm::StatementKind&
      func_decl: const ebm::FunctionDecl&
        name: IdentifierRef
        return_type: TypeRef
        params: Block
          len: Varint
          container: std::vector<StatementRef>
        parent_format: WeakStatementRef
        kind: FunctionKind
        property: *WeakStatementRef
        body: StatementRef
*/
/*DO NOT EDIT ABOVE SECTION MANUALLY*/

#include "../codegen.hpp"
DEFINE_VISITOR(Statement_FUNCTION_DECL) {
    using namespace CODEGEN_NAMESPACE;
    CodeWriter out;

    // 関数名を識別子から取得
    std::string func_name = ctx.identifier();

    out.writeln("");
    out.writeln("# Verification for function: " + func_name);
    out.writeln("def verify_" + func_name + "():");
    auto scope = out.indent_scope();
    out.writeln(ctx.config().solver_name, " = z3.Solver()");

    // パラメータを Z3 変数として宣言 (バージョン0)
    // ここで ctx.func_decl.params.container を走査して BitVec を宣言
    for (auto& param_ref : ctx.func_decl.params.container) {
        // パラメータの型情報から BitVec(name, size) を出力
        MAYBE(param, ctx.visit(param_ref));
        out.write(std::move(param.to_writer()));
        // out.writeln("v{0}_v0 = z3.BitVec('v{0}', {1})"._fmt(id, size));
    }

    MAYBE(body, ctx.visit(ctx.func_decl.body));

    out.write(std::move(body.to_writer()));

    return out;
}
