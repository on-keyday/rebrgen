/*DO NOT EDIT BELOW SECTION MANUALLY*/
/*license*/
// Template generated by ebmcodegen at https://github.com/on-keyday/rebrgen
/*
  Name: Statement_VARIABLE_DECL_before_class
  Available Variables:
    ctx: Context_Statement_VARIABLE_DECL_before<Result>
      visitor: MergedVisitor&
        program_name: static constexpr const char*
        flags: Flags&
        output: Output&
        wm: ebmcodegen::WriterManager<CodeWriter>
        module_: ebmgen::MappingTable
      item_id: ebm::StatementRef
      kind: const ebm::StatementKind&
      var_decl: const ebm::VariableDecl&
        name: IdentifierRef
        var_type: TypeRef
        initial_value: ExpressionRef
        decl_kind: VariableDeclKind
        is_reference: bool
        reserved: std::uint8_t
      main_logic: ebmcodegen::util::MainLogicWrapper<Result>
*/
/*DO NOT EDIT ABOVE SECTION MANUALLY*/

#include "../codegen.hpp"
DEFINE_VISITOR(Statement_VARIABLE_DECL_before) {
    using namespace CODEGEN_NAMESPACE;
    /*here to write the hook*/
    MAYBE(type, ctx.get(ctx.var_decl.var_type));
    if (type.body.kind == ebm::TypeKind::ENCODER_RETURN && ctx.config().append_io) {
        auto io = ctx.identifier(ctx.config().current_io);
        ctx.config().variable_initializer = "=";  // temporary
        auto ident = ctx.identifier();
        CodeWriter w;
        w.writeln("var ", ident, " error");
        MAYBE(main, ctx.main_logic());
        ctx.config().variable_initializer = ":=";
        w.writeln(io, ",", main.to_writer());
        return w;
    }
    return pass;
}
