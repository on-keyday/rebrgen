## 5. テストと検証

### 5.1 `unictest.py`による自動テスト
`script/unictest.py`スクリプトは、`script/unictest_setup.py`と連携して、包括的な自動テストおよび開発ワークフローを提供します。以下のステップを調整します。
1.  **EBM生成**: ソースファイル (例: `.bgn`ファイル) を`ebmgen`を使用してEBM形式に変換します。
2.  **コードジェネレーター実行**: 生成されたEBMファイルを使用して、ターゲットコードジェネレーター (例: `ebm2rust`) を実行します。
3.  **ビジターフックデバッグ**: 「setup」モードで実行すると、`--debug-unimplemented`フラグを使用して、コードジェネレーター内の未実装のビジターフックを識別し報告します。
4.  **テスト実行**: 「test」モードで、言語固有のテストスクリプトを実行して、生成された出力と期待される結果を比較します。
このフレームワークは、反復的なタスクを自動化し、ビジターフック実装のステータスに関する明確なフィードバックを提供することで、開発プロセスを簡素化します。

### 5.2 `ebmtest.py`
`ebmtest.py`は、`ebmgen`によって出力されたEBM JSON (`.ebm`) がスキーマ定義 (`ebmcodegen --mode spec-json`で取得) に準拠し、Ref解決の深い等価性チェックを含むテストケースで定義された期待値と一致することを検証します。

### 5.3 EBMインタラクティブクエリエンジン
`ebmgen`実行可能ファイルには、EBMファイルを検査するための強力なクエリエンジンが含まれており、インタラクティブデバッガ (`./tool/ebmgen -i <path/to/input.ebm> --interactive`) または直接コマンドライン実行 (`./tool/ebmgen -i <path/to/input.ebm> -q "Query"`) を介して使用できます。
クエリ構文は`<ObjectType> { <conditions> }`であり、`Identifier`、`String`、`Type`、`Statement`、`Expression`、`Any`オブジェクトタイプをサポートし、比較、論理演算、包含チェックに`==`、`!=`、`>`、`>=`、`<`、`<=`、`and`、`or`、`not`、`contains`を使用します。フィールドアクセスは、`Ref`タイプのポインタのような間接参照に`->`を使用し、修飾名の一致に`.`または`[]`を使用します。リテラルには数値 (10進数/16進数) と二重引用符で囲まれた文字列が含まれます。
