/*DO NOT EDIT BELOW SECTION MANUALLY*/
/*license*/
// Template generated by ebmcodegen at https://github.com/on-keyday/rebrgen
/*
  Name: Statement_WRITE_DATA
  Available variables:
    visitor: Visitor
    module_: MappingTable
    item_id: StatementRef
    generator_default_logic: std::function<expected<Result>()>
    default_logic: std::function<expected<Result>()>
    kind: StatementKind
    write_data: IOData
      io_ref: StatementRef
      field: StatementRef
      target: ExpressionRef
      data_type: TypeRef
      attribute: IOAttribute
        endian: Endian
        sign: bool
        is_peek: bool
        has_lowered_statement: bool
        reserved: std::uint8_t
        dynamic_ref: *StatementRef
      size: Size
        unit: SizeUnit
        ref: *ExpressionRef
        size: *Varint
      lowered_statement: *LoweredIOStatement
        lowering_type: LoweringIOType
        io_statement: LoweredStatementRef
*/
/*DO NOT EDIT ABOVE SECTION MANUALLY*/

/*here to write the hook*/
/*DO NOT EDIT BELOW SECTION MANUALLY*/
/*license*/
// Template generated by ebmcodegen at https://github.com/on-keyday/rebrgen
/*
  Name: Statement_WRITE_DATA
  Available variables:
    visitor: Visitor
    module_: MappingTable
    item_id: StatementRef
    generator_default_logic: std::function<expected<Result>()>
    default_logic: std::function<expected<Result>()>
    kind: StatementKind
    write_data: IOData
      io_ref: StatementRef
      field: StatementRef
      target: ExpressionRef
      data_type: TypeRef
      attribute: IOAttribute
        endian: Endian
        sign: bool
        is_peek: bool
        has_lowered_statement: bool
        reserved: std::uint8_t
        dynamic_ref: *StatementRef
      size: Size
        unit: SizeUnit
        ref: *ExpressionRef
        size: *Varint
      lowered_statement: *LoweredIOStatement
        lowering_type: LoweringIOType
        io_statement: LoweredStatementRef
*/
/*DO NOT EDIT ABOVE SECTION MANUALLY*/

/*here to write the hook*/

if (auto lw = write_data.lowered_statement()) {
    return visit_Statement(*this, lw->io_statement.id);
}

MAYBE(target, visit_Expression(*this, write_data.target));
MAYBE(type, module_.get_type(write_data.data_type));
auto io_name = module_.get_associated_identifier(write_data.io_ref);
MAYBE(size, get_size_str(*this, write_data.size));

CodeWriter w;

if (auto cand = is_bytes_type(*this, write_data.data_type)) {
    w.writeln(io_name, ".write_all(&", target.to_writer(), "[..", size, "]", ")?;");
}
else {
    return unexpect_error("unsupported type for READ_DATA: {}", to_string(type.body.kind));
}

return w;