# 用語集：中級者向け（言語ジェネレータ開発者）

このドキュメントは、`rebrgen`フレームワークを利用して、特定の言語（例: Rust, Python）向けのコードジェネレータを開発する開発者向けの用語集です。

## 開発ワークフローと主要ツール

- **ebmcodegen**
  - **役割**: 新しい言語ジェネレータ（`ebm2<your_lang>`）のC++製スケルトンコードを自動生成するツール。
  - **使い方**: 新しい言語のサポートを追加する際の最初のステップとして利用します。

- **ビジターフック (visitor hook)**
  - **役割**: EBMの各要素（`if`文や特定のデータ型など）を、ターゲット言語のコードにどう翻訳するかのロジックを実装するC++コード断片（`.hpp`ファイル）。
  - **詳細**: これが言語ジェネレータ開発における**主要な実装作業**となります。`ebmcodegen`が生成した関数本体に、このフックファイルが`#include`される形で組み込まれます。

- **ebmtemplate.py**
  - **役割**: `visitor hook`ファイルの生成と管理を簡単にするためのヘルパースクリプト。
  - **使い方**: 新しいフックを作成したり、EBMの構造変更に伴いフック内の変数情報を更新したりする際に使用します。

- **unictest.py**
  - **役割**: 開発中のジェネレータをテストするための主要スクリプト。
  - **機能**: `ebmgen`の実行、開発中ジェネレータの実行、テストの実行までを自動で行います。未実装のビジターフックを検出する機能もあります。

- **build.py**
  - **役割**: プロジェクト全体のビルド（コンパイル）を行うための中心的なスクリプト。
  - **使い方**: ソースコードに変更を加えた後、このスクリプトを実行して、`ebmgen`や`ebmcodegen`といったツールを最新の状態に更新します。

- **ebmdsl.py**
  - **役割**: `.dsl`ファイルをC++製のビジターフック（`.hpp`ファイル）にコンパイルするスクリプト。
  - **使い方**: 開発者は、より簡潔なDSLでコード生成ロジックを記述し、このスクリプトを使って自動的にC++コードに変換します。これにより、複雑なビジターフックを手で書く手間が省けます。

## EBMの基本

- **EBM (ExtendedBinaryModule)**
  - **役割**: `rebrgen`プロジェクトの中心的な中間表現(IR)。全ての言語ジェネレータは、このEBMを読み込んでコード生成を行います。
  - **特徴**: オブジェクトがIDで管理され、`...Ref`型によって相互にリンクされるグラフ構造を持っています。

- **...Ref 型 (例: `StatementRef`, `TypeRef`)**
  - **役割**: EBM内でオブジェクトを指し示す参照型。実体は単なるIDのラッパーです。
  - **使い方**: ジェネレータ開発では、この参照を辿ってEBMのグラフ構造をナビゲートし、必要な情報を取得します。

## C++実装の詳細

- **MAYBE マクロ**
  - **役割**: ビジターフック内で多用されるエラーハンドリング用のマクロ。
  - **動作**: Rustの`?`演算子のように、エラー状態（`expected<T>`がエラー値を持つ場合など）をチェックし、エラーであれば即座に早期リターンします。

- **get_associated_identifier**
  - **役割**: EBMの要素（文、式、型など）に関連付けられた識別子（変数名、関数名など）の文字列名を取得するための関数。
  - **使い方**: ビジターフック内で名前を取得する際の推奨される方法です。
