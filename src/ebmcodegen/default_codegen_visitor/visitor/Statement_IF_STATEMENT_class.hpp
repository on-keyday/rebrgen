/*DO NOT EDIT BELOW SECTION MANUALLY*/
/*license*/
// Template generated by ebmcodegen at https://github.com/on-keyday/rebrgen
/*
  Name: Statement_IF_STATEMENT_class
  Available Variables:
    ctx: Context_Statement_IF_STATEMENT
      visitor: MergedVisitor&
        program_name: static constexpr const char*
        flags: Flags&
        output: Output&
        wm: ebmcodegen::WriterManager<CodeWriter>
        module_: ebmgen::MappingTable
      item_id: ebm::StatementRef
      kind: const ebm::StatementKind&
      if_statement: const ebm::IfStatement&
        condition: Condition
          cond: ExpressionRef
        then_block: StatementRef
        else_block: StatementRef
*/
/*DO NOT EDIT ABOVE SECTION MANUALLY*/

#include "../codegen.hpp"
DEFINE_VISITOR(Statement_IF_STATEMENT) {
    using namespace CODEGEN_NAMESPACE;
    if (ctx.config().if_statement_custom) {
        CALL_OR_PASS(custom_result, ctx.config().if_statement_custom(ctx));
    }
    MAYBE(condition, ctx.visit(ctx.if_statement.condition.cond));
    MAYBE(then_block, ctx.visit(ctx.if_statement.then_block));
    CodeWriter w;
    if (ctx.config().use_brace_for_condition) {
        w.writeln("if (", tidy_condition_brace(std::move(condition.to_string())), ") ", ctx.config().begin_block);
    }
    else {
        w.writeln("if ", tidy_condition_brace(std::move(condition.to_string())), " ", ctx.config().begin_block);
    }
    auto then_scope = w.indent_scope();
    if (then_block.to_writer().empty()) {
        if (ctx.config().empty_block_marker.size()) {
            w.writeln(ctx.config().empty_block_marker);
        }
    }
    else {
        w.write(then_block.to_writer());
    }

    then_scope.execute();
    w.write(ctx.config().end_block);
    auto els_block = ctx.if_statement.else_block;
    auto if_word = ctx.config().use_elif ? "elif" : "if";
    while (!is_nil(els_block)) {
        if (!ctx.config().use_elif) {
            w.write(" else ");
        }
        auto kind = ctx.get_kind(els_block);
        if (kind == ebm::StatementKind::IF_STATEMENT) {
            MAYBE(next_if_stmt, ctx.get(els_block));
            MAYBE(next_if, next_if_stmt.body.if_statement());

            MAYBE(condition, ctx.visit(next_if.condition.cond));
            MAYBE(then_block, ctx.visit(next_if.then_block));
            if (ctx.config().use_brace_for_condition) {
                w.writeln(if_word, " (", tidy_condition_brace(std::move(condition.to_string())), ") ", ctx.config().begin_block);
            }
            else {
                w.writeln(if_word, " ", tidy_condition_brace(std::move(condition.to_string())), " ", ctx.config().begin_block);
            }
            auto then_scope = w.indent_scope();
            if (then_block.to_writer().empty()) {
                if (ctx.config().empty_block_marker.size()) {
                    w.writeln(ctx.config().empty_block_marker);
                }
            }
            else {
                w.write(then_block.to_writer());
            }
            then_scope.execute();
            w.write(ctx.config().end_block);
            els_block = next_if.else_block;
        }
        else {
            if (ctx.config().use_elif) {
                w.write("else");
            }
            MAYBE(else_block, ctx.visit(els_block));
            w.writeln(ctx.config().begin_block);
            auto else_scope = w.indent_scope();
            if (else_block.to_writer().empty()) {
                if (ctx.config().empty_block_marker.size()) {
                    w.writeln(ctx.config().empty_block_marker);
                }
            }
            else {
                w.write(else_block.to_writer());
            }
            else_scope.execute();
            w.write(ctx.config().end_block);
            els_block = {};
        }
    }
    w.writeln();
    return w;
}